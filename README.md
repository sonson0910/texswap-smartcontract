# Midnight FaucetAMM DEX Contract

Smart contract implementation for a decentralized exchange (DEX) with Faucet capabilities on the Midnight Network, written in Compact.

## üõ†Ô∏è Technology Stack & Versions

Verified configurations used in this project:

| Component | Version | Description |
|-----------|---------|-------------|
| **Compact Runtime** | `0.14.0` | Core runtime for smart contracts |
| **Compact JS** | `^2.4.0` | JS bindings for Compact |
| **Midnight JS Contracts** | `3.0.0` | Contract interaction SDK |
| **Midnight Ledger** | `6.2.0-rc.3` / `7.0.0` | Ledger interaction |
| **Onchain Runtime** | `^2.0.0` | V2 Runtime support |
| **Proof Server** | `latest` | ZK Proof generation service |
| **Node.js** | `v20` / `v22` | Runtime environment |
| **pnpm** | `10.20.0` | Package manager |

## ‚öôÔ∏è Configuration

### 1. Network Configuration (`deploy-cli/src/config.ts`)
The project is configured for the **Midnight Preview Network**:

- **Network ID**: `preview`
- **Indexer/Graphql**: `https://indexer.preview.midnight.network/api/v3/graphql`
- **Node RPC**: `wss://rpc.preview.midnight.network`
- **Proof Server**: `http://127.0.0.1:6300` (Local Docker container)

### 2. Environment Variables (`deploy-cli/.env`)
Create a `.env` file in `deploy-cli/` with the following:

```env
# Your wallet mnemonic phrase (12-24 words)
WALLET_MNEMONIC="your mnemonic phrase here ..."

# Deployed Contract Address (Automatic update recommended, but can be set manually)
CONTRACT_ADDRESS=a7871813245b07113eaf5dc864c1f9f363bbd8a046f9ef2da3169c2b918a37ed
```

## üöÄ Getting Started

### 1. Prerequisites
- Docker (for Proof Server)
- Node.js (v20+)
- Compact Toolchain installed

### 2. Start Proof Server
Run the proof server locally in a separate terminal:

```bash
docker run -p 6300:6300 midnightnetwork/proof-server:latest \
  -- midnight-proof-server --network preview
```

### 3. Install Dependencies
Root dependencies:
```bash
pnpm install
```

CLI dependencies:
```bash
cd deploy-cli
npm install
```

### 4. Compile Contract
From the project root:
```bash
compact compile src/FaucetAMMUnshielded.compact build/FaucetAMMUnshielded
```
*Note: This generates the `.zk` and `.compact` artifacts in `build/`.*

### 5. Deploy Contract
Build and deploy the contract to the Preview network:

```bash
# Copy artifacts to dist
mkdir -p deploy-cli/dist/faucet-amm-unshielded
cp -r build/FaucetAMMUnshielded/* deploy-cli/dist/faucet-amm-unshielded/

# Run deployment
cd deploy-cli
npm run deploy
```

## üíª CLI Usage

All commands are run from the `deploy-cli` directory.

### Mint Tokens (Faucet)
Mint test tokens to your wallet:

```bash
# Mint 1,000,000 X Tokens
npm run interact -- mint-x

# Mint 1,000,000 Y Tokens
npm run interact -- mint-y
```

### Liquidity Operations
Manage liquidity pool (Note: `init` currently has known proof generation issues):

```bash
# Initialize Pool (Requires 2 tokens) - *Currently BLOCKED by Proof Server 400*
npm run interact -- init <xAmount> <yAmount>
# Example: npm run interact -- init 500000 500000

# Add Liquidity
npm run interact -- add <xAmount> <yAmount> <lpAmount>

# Remove Liquidity
npm run interact -- remove <lpAmount> <xOut> <yOut>
```

### Swaps
Execute swaps between tokens:

```bash
# Swap X -> Y
npm run interact -- swap-x-y <xIn> <yOut>

# Swap Y -> X
npm run interact -- swap-y-x <yIn> <xOut>
```

## üìÑ Current Deployment Status

- **Contract Address**: `a7871813245b07113eaf5dc864c1f9f363bbd8a046f9ef2da3169c2b918a37ed`
- **Network**: Midnight Preview
- **Last Verified Status**: 
    - Deployment: ‚úÖ Success
    - Minting X/Y: ‚úÖ Success
    - Init Liquidity: ‚ùå Blocked (Proof Server check error)

---
*Generated by Antigravity*
